<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post Office RD Calculator</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Modern UI ke liye custom styles */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #eef2f6; 
        }
        .card {
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.15); 
            transition: transform 0.3s ease-in-out;
        }
        .input-field {
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .input-field:focus {
            border-color: #10b981; 
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.4);
        }
        .result-box {
            background-color: #f0fdf4; 
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8 flex items-center justify-center">

    <div class="w-full max-w-4xl">
        <!-- Copy Feedback Message -->
        <div id="copyFeedback" class="fixed top-5 left-1/2 transform -translate-x-1/2 bg-green-600 text-white px-6 py-3 rounded-xl shadow-xl opacity-0 transition-opacity duration-300 pointer-events-none z-50 font-semibold">
            Results copied to clipboard!
        </div>
        
        <h1 class="text-3xl sm:text-2xl font-extrabold text-gray-900 mb-8 text-center tracking-tight">
            Post Office RD Calculator
        </h1>

        <div class="card bg-white p-6 md:p-10 rounded-2xl grid grid-cols-1 lg:grid-cols-2 gap-8">

            <!-- Input Section -->
            <div class="space-y-6">
                <h2 class="text-xl font-semibold text-teal-600 border-b-2 pb-2 border-teal-100">Deposit Details</h2>

                <!-- Manual Date Entry (3 Separate Boxes with Centered Text) -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Account Opening Date (DD-MM-YYYY)</label>
                    <div class="flex space-x-2">
                        <input type="number" id="dayInput" placeholder="DD" min="1" max="31" class="input-field w-1/4 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none text-center" oninput="updateInterestRateAndCalculate()">
                        <input type="number" id="monthInput" placeholder="MM" min="1" max="12" class="input-field w-1/4 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none text-center" oninput="updateInterestRateAndCalculate()">
                        <input type="number" id="yearInput" placeholder="YYYY" min="1981" max="2099" class="input-field w-2/4 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none text-center" oninput="updateInterestRateAndCalculate()">
                    </div>
                </div>

                <div>
                    <label for="denomination" class="block text-sm font-medium text-gray-700 mb-1">Installment (Monthly Deposit in ₹)</label>
                    <input type="number" id="denomination" placeholder="Ex: 1000" min="10" class="input-field w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none" oninput="calculateRD()">
                </div>

                <!-- Interest Rate Input -->
                <div>
                    <label for="interestRate" class="block text-sm font-medium text-gray-700 mb-1">Current Interest Rate (Annual %)</label>
                    <div class="flex items-center space-x-2">
                        <input type="number" id="interestRate" placeholder="Auto-filled or Enter Manually" min="0" step="0.1" class="input-field w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none bg-yellow-50" oninput="calculateRD()">
                        <button onclick="openRateModal()" class="flex-shrink-0 p-2 bg-blue-600 text-white rounded-full shadow-lg hover:bg-blue-700 transition duration-150 transform hover:scale-105" title="View Historical Interest Rates">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-5 h-5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.027m0 0 1.94 2.155 1.76-2.505.795-1.52m-3.999-.75h.001m.75 3.75h.001m-2.25 0h.001m-2.25 0h.001m13.5-3.75v3.375c0 1.066-.317 2.054-.863 2.895l-1.4 2.25c-.417.67-.998 1.15-1.63 1.344a6.793 6.793 0 0 1-1.696.06c-1.334-.08-2.583-.56-3.617-1.488l-1.455-1.334c-.958-.877-1.577-2.074-1.602-3.328A6.79 6.79 0 0 1 3.75 6.094V6.75h16.5m-1.5-4.5h.008v.008H20.25Z" />
                            </svg>
                        </button>
                    </div>
                    <p id="rateNote" class="text-xs text-yellow-800 mt-1">
                        Rate is automatically filled based on the selected opening date.
                    </p>
                </div>

                <div class="flex justify-end pt-4 space-x-4">
                    <button onclick="copyResults()" class="px-4 py-1.5 text-sm bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition duration-150 transform hover:scale-[1.02]" id="copyButton">
                        Copy Results
                    </button>
                    <button onclick="clearForm()" class="px-4 py-1.5 text-sm bg-red-600 text-white font-semibold rounded-lg shadow-md hover:bg-red-700 transition duration-150 transform hover:scale-[1.02]">
                        Clear All
                    </button>
                </div>
            </div>

            <!-- Result Section -->
            <div id="results" class="space-y-8 lg:pt-10">
                <h2 class="sr-only">Calculated Results</h2>
                
                <div class="bg-indigo-100 p-4 rounded-xl">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm font-medium text-gray-700">Maturity Date (5 Years)</span>
                        <span id="maturityDate" class="text-base font-bold text-indigo-800">--</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm font-medium text-gray-700">Pre-Maturity Date (3 Years)</span>
                        <span id="preMaturityDate" class="text-base font-bold text-indigo-800">--</span>
                    </div>
                </div>

                <!-- Maturity Details -->
                <div class="result-box p-6 rounded-xl border border-teal-300">
                    <h3 class="text-base font-bold text-teal-800 mb-4 border-b pb-2 border-teal-200">Maturity (5 Years)</h3>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-700">Total Deposited Amount:</span>
                            <span id="maturityPrincipal" class="text-base font-medium text-gray-900">--</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-700">Interest Earned:</span>
                            <span id="maturityInterest" class="text-base font-medium text-green-700">--</span>
                        </div>
                        <div class="flex justify-between pt-2 border-t border-teal-200">
                            <span class="text-base font-bold text-teal-900">Maturity Amount (Total):</span>
                            <span id="maturityAmount" class="text-base font-bold text-teal-900">--</span>
                        </div>
                    </div>
                </div>

                <!-- Pre-Maturity Details -->
                <div class="result-box p-6 rounded-xl border border-orange-300 bg-orange-50">
                    <h3 class="text-base font-bold text-orange-800 mb-4 border-b pb-2 border-orange-200">Pre-Maturity (3 Years, @ 4% Savings Rate)</h3>
                    <div class="space-y-2">
                         <div class="flex justify-between">
                            <span class="text-sm text-gray-700">Total Deposited Amount:</span>
                            <span id="preMaturityPrincipal" class="text-base font-medium text-gray-900">--</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-700">Interest Earned:</span>
                            <span id="preMaturityInterest" class="text-base font-medium text-green-700">--</span>
                        </div>
                        <div class="flex justify-between pt-2 border-t border-orange-200">
                            <span class="text-base font-bold text-orange-900">Pre-Maturity Amount (Total):</span>
                            <span id="preMaturityAmount" class="text-base font-bold text-orange-900">--</span>
                        </div>
                    </div>
                </div>
                
                 <div class="bg-gray-100 p-4 rounded-xl space-y-2">
                    <div class="flex justify-between items-center">
                        <span class="text-sm font-medium text-gray-600">Avg. Monthly Interest (Over 5 Years):</span>
                        <span id="avgInterestMonth" class="text-base font-bold text-green-700">--</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm font-medium text-gray-600">Avg. Yearly Interest (Over 5 Years):</span>
                        <span id="avgInterestYear" class="text-base font-bold text-green-700">--</span>
                    </div>
                </div>
            </div>
        </div>

        <p class="text-center text-xs text-gray-500 mt-6">
            Disclaimer: Yeh calculator Future Value formula par adharit hai. Post Office RD quarterly compounding use karta hai, isliye results me thoda farak ho sakta hai. Pre-Maturity calculation me 4% Savings Account rate use kiya gaya hai.
        </p>
    </div>

    <!-- Historical Interest Rate Modal -->
    <div id="rateModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 transition-opacity duration-300 opacity-0 pointer-events-none">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl m-4 transform scale-95 transition-transform duration-300">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center sticky top-0 bg-white z-10">
                <h3 class="text-xl font-bold text-gray-800">Historical RD Interest Rates (1981-Present)</h3>
                <button onclick="closeRateModal()" class="text-gray-400 hover:text-gray-600 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="p-6 max-h-[70vh] overflow-y-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50 sticky top-0">
                        <tr>
                            <th class="px-3 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">From</th>
                            <th class="px-3 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">To</th>
                            <th class="px-3 py-3 text-right text-xs font-bold text-gray-700 uppercase tracking-wider">Rate (%)</th>
                        </tr>
                    </thead>
                    <tbody id="rateTableBody" class="bg-white divide-y divide-gray-200 text-sm">
                    </tbody>
                </table>
            </div>
            <div class="p-4 border-t border-gray-200 text-right">
                <button onclick="closeRateModal()" class="px-4 py-2 text-sm font-medium rounded-lg bg-teal-600 text-white hover:bg-teal-700 transition">
                    Close
                </button>
            </div>
        </div>
    </div>

    <script>
        const monthNames = [
            "January", "February", "March", "April", "May", "June", 
            "July", "August", "September", "October", "November", "December"
        ];
        
        const RD_RATES = [
            { from: "01-04-1981", to: "31-03-1982", rate: 9.00 },
            { from: "01-04-1982", to: "28-02-1983", rate: 10.30 },
            { from: "01-03-1983", to: "31-03-1987", rate: 11.30 },
            { from: "01-04-1987", to: "31-03-1991", rate: 11.00 },
            { from: "01-04-1991", to: "30-09-1991", rate: 11.50 },
            { from: "01-10-1991", to: "01-09-1993", rate: 13.50 },
            { from: "02-09-1993", to: "31-12-1998", rate: 12.50 },
            { from: "01-01-1999", to: "31-12-1999", rate: 11.50 },
            { from: "01-01-2000", to: "14-01-2000", rate: 11.50 },
            { from: "15-01-2000", to: "31-01-2000", rate: 10.50 },
            { from: "01-02-2000", to: "28-02-2001", rate: 10.50 },
            { from: "01-03-2001", to: "28-02-2002", rate: 9.00 },
            { from: "01-03-2002", to: "28-02-2003", rate: 8.50 },
            { from: "01-03-2003", to: "01-08-2004", rate: 7.50 },
            { from: "02-08-2004", to: "30-11-2011", rate: 7.50 },
            { from: "01-12-2011", to: "31-03-2012", rate: 8.00 },
            { from: "01-04-2012", to: "31-03-2013", rate: 8.40 },
            { from: "01-04-2013", to: "31-03-2014", rate: 8.30 },
            { from: "01-04-2014", to: "17-11-2014", rate: 8.40 },
            { from: "18-11-2014", to: "20-01-2015", rate: 8.40 },
            { from: "21-01-2015", to: "31-03-2015", rate: 8.40 },
            { from: "01-04-2015", to: "31-03-2016", rate: 8.40 },
            { from: "01-04-2016", to: "30-09-2016", rate: 7.40 },
            { from: "01-10-2016", to: "31-03-2017", rate: 7.30 },
            { from: "01-04-2017", to: "30-06-2017", rate: 7.20 },
            { from: "01-07-2017", to: "31-12-2017", rate: 7.10 },
            { from: "01-01-2018", to: "30-09-2018", rate: 6.90 },
            { from: "01-10-2018", to: "31-12-2018", rate: 7.30 },
            { from: "01-01-2019", to: "31-03-2019", rate: 7.30 },
            { from: "01-04-2019", to: "30-06-2019", rate: 7.30 },
            { from: "01-07-2019", to: "30-09-2019", rate: 7.20 },
            { from: "01-10-2019", to: "31-12-2019", rate: 7.20 },
            { from: "01-01-2020", to: "31-03-2020", rate: 7.20 },
            { from: "01-04-2020", to: "30-09-2022", rate: 5.80 },
            { from: "01-10-2022", to: "31-12-2022", rate: 5.80 },
            { from: "01-01-2023", to: "31-03-2023", rate: 5.80 },
            { from: "01-04-2023", to: "30-06-2023", rate: 6.20 },
            { from: "01-07-2023", to: "30-09-2023", rate: 6.50 },
            { from: "01-10-2023", to: "31-03-2024", rate: 6.70 }
        ];

        function parseDate(dateStr) {
            const parts = dateStr.split('-');
            return new Date(parts[2], parts[1] - 1, parts[0]);
        }
        
        function getRateForDate(selectedDate) {
            if (!selectedDate || isNaN(selectedDate.getTime())) return null;
            for (const range of RD_RATES) {
                const startDate = parseDate(range.from);
                const endDate = parseDate(range.to);
                if (selectedDate >= startDate && selectedDate <= endDate) {
                    return range.rate;
                }
            }
            const lastKnownRate = RD_RATES[RD_RATES.length - 1];
            const lastDate = parseDate(lastKnownRate.to);
            if (selectedDate > lastDate) {
                 return lastKnownRate.rate;
            }
            return null;
        }

        function populateRateTable() {
            const tableBody = document.getElementById('rateTableBody');
            tableBody.innerHTML = ''; 
            [...RD_RATES].reverse().forEach(rateItem => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-3 py-2 whitespace-nowrap">${rateItem.from}</td>
                    <td class="px-3 py-2 whitespace-nowrap">${rateItem.to}</td>
                    <td class="px-3 py-2 whitespace-nowrap text-right font-semibold text-teal-700">${rateItem.rate.toFixed(2)}</td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function openRateModal() {
            const modal = document.getElementById('rateModal');
            modal.classList.remove('pointer-events-none', 'opacity-0');
            modal.classList.add('opacity-100');
            document.querySelector('#rateModal > div').classList.remove('scale-95');
            document.querySelector('#rateModal > div').classList.add('scale-100');
        }

        function closeRateModal() {
            const modal = document.getElementById('rateModal');
            modal.classList.remove('opacity-100');
            modal.classList.add('opacity-0');
            document.querySelector('#rateModal > div').classList.remove('scale-100');
            document.querySelector('#rateModal > div').classList.add('scale-95');
            setTimeout(() => { modal.classList.add('pointer-events-none'); }, 300); 
        }

        function updateInterestRateAndCalculate() {
            const d = parseInt(document.getElementById('dayInput').value);
            const m = parseInt(document.getElementById('monthInput').value);
            const y = parseInt(document.getElementById('yearInput').value);
            const rateInput = document.getElementById('interestRate');

            if (!isNaN(d) && !isNaN(m) && !isNaN(y)) {
                const selectedDate = new Date(y, m - 1, d);
                // Basic validation: check if JS rollover happened (e.g. 31 Feb -> 3 Mar)
                if (selectedDate.getDate() === d && selectedDate.getMonth() === m - 1) {
                    const rate = getRateForDate(selectedDate);
                    if (rate !== null) {
                        rateInput.value = rate.toFixed(2);
                    } else {
                        rateInput.value = "";
                        document.getElementById('rateNote').textContent = "Could not find historical rate. Please enter manually.";
                    }
                } else {
                    rateInput.value = "";
                    document.getElementById('rateNote').textContent = "Invalid Date entered.";
                }
            } else {
                rateInput.value = ""; 
                document.getElementById('rateNote').textContent = "Rate automatically fills when full date is entered.";
            }
            calculateRD();
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Set Default Date to Today
            const now = new Date();
            document.getElementById('dayInput').value = now.getDate();
            document.getElementById('monthInput').value = now.getMonth() + 1;
            document.getElementById('yearInput').value = now.getFullYear();

            populateRateTable(); 
            updateInterestRateAndCalculate(); 
        });

        const formatter = new Intl.NumberFormat('en-IN', {
            style: 'currency',
            currency: 'INR',
            minimumFractionDigits: 0,
            maximumFractionDigits: 0
        });
        
        function showFeedback(message) {
            const feedback = document.getElementById('copyFeedback');
            feedback.textContent = message;
            feedback.classList.remove('bg-green-600', 'bg-red-600');
            if (message.includes("copied")) {
                 feedback.classList.add('bg-green-600');
            } else {
                 feedback.classList.add('bg-red-600');
            }
            feedback.classList.remove('opacity-0');
            feedback.classList.add('opacity-100');
            setTimeout(() => {
                feedback.classList.remove('opacity-100');
                feedback.classList.add('opacity-0');
            }, 2000);
        }

        function copyResults() {
            const maturityPrincipalText = document.getElementById('maturityPrincipal').textContent;
            if (maturityPrincipalText === '--') {
                showFeedback("Pehle saari details bharein!");
                return;
            }

            const d = document.getElementById('dayInput').value;
            const m = document.getElementById('monthInput').value;
            const y = document.getElementById('yearInput').value;
            const denomination = document.getElementById('denomination').value;
            const rate = document.getElementById('interestRate').value;

            const resultsText = `
--- Post Office RD Calculation Summary ---
Deposit Details:
- Monthly Deposit (₹): ${denomination}
- Annual Rate (%): ${rate}
- Opening Date: ${d}-${m}-${y}
-----------------------------------------

Maturity (5 Years):
- Maturity Date: ${document.getElementById('maturityDate').textContent}
- Total Deposited: ${document.getElementById('maturityPrincipal').textContent}
- Interest Earned: ${document.getElementById('maturityInterest').textContent}
- Total Maturity Amount: ${document.getElementById('maturityAmount').textContent}

Pre-Maturity (3 Years):
- Pre-Maturity Date: ${document.getElementById('preMaturityDate').textContent}
- Total Deposited: ${document.getElementById('preMaturityPrincipal').textContent}
- Interest Earned: ${document.getElementById('preMaturityInterest').textContent}
- Total Amount: ${document.getElementById('preMaturityAmount').textContent}
            `.trim();

            const textarea = document.createElement('textarea');
            textarea.value = resultsText;
            textarea.style.position = 'fixed'; 
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                showFeedback("Results copied to clipboard!");
            } catch (err) {
                showFeedback("Copy failed.");
            }
            document.body.removeChild(textarea);
        }

        function clearForm() {
            const now = new Date();
            document.getElementById('dayInput').value = now.getDate();
            document.getElementById('monthInput').value = now.getMonth() + 1;
            document.getElementById('yearInput').value = now.getFullYear();
            document.getElementById('denomination').value = "";
            document.getElementById('interestRate').value = "";
            updateInterestRateAndCalculate();
        }

        function calculateRD() {
            const denomination = parseFloat(document.getElementById('denomination').value);
            const rate = parseFloat(document.getElementById('interestRate').value);
            const d = parseInt(document.getElementById('dayInput').value);
            const m = parseInt(document.getElementById('monthInput').value);
            const y = parseInt(document.getElementById('yearInput').value);
            
            if (isNaN(denomination) || denomination <= 0 || isNaN(rate) || rate <= 0 || isNaN(d) || isNaN(m) || isNaN(y)) {
                document.querySelectorAll('#results span').forEach(el => {
                    if (el.id) el.textContent = '--';
                });
                return;
            }

            const openingDate = new Date(y, m - 1, d);
            const monthlyRate = rate / 100 / 12;
            const monthlyPayment = denomination;

            // Date Calcs
            const maturityDate = new Date(openingDate);
            maturityDate.setFullYear(openingDate.getFullYear() + 5);
            const preMaturityDate = new Date(openingDate);
            preMaturityDate.setFullYear(openingDate.getFullYear() + 3);

            // Maturity (5Y)
            const termMaturity = 60;
            const principalMaturity = monthlyPayment * termMaturity;
            const fvFactorMaturity = (Math.pow(1 + monthlyRate, termMaturity) - 1) / monthlyRate;
            const maturityAmount = monthlyPayment * fvFactorMaturity * (1 + monthlyRate);
            const maturityInterest = maturityAmount - principalMaturity;
            
            // Pre-Maturity (3Y) - 4% Savings Rate
            const termPreMaturity = 36;
            const principalPreMaturity = monthlyPayment * termPreMaturity;
            const monthlySavingsRate = 4 / 100 / 12;
            const fvFactorPreMaturity = (Math.pow(1 + monthlySavingsRate, termPreMaturity) - 1) / monthlySavingsRate;
            const preMaturityAmount = monthlyPayment * fvFactorPreMaturity * (1 + monthlySavingsRate); 
            const preMaturityInterest = preMaturityAmount - principalPreMaturity;

            // Averages
            const avgInterestMonth = maturityInterest / termMaturity;
            const avgInterestYear = maturityInterest / 5;

            // Display
            document.getElementById('maturityDate').textContent = maturityDate.toLocaleDateString('en-IN', { year: 'numeric', month: 'short', day: 'numeric' });
            document.getElementById('preMaturityDate').textContent = preMaturityDate.toLocaleDateString('en-IN', { year: 'numeric', month: 'short', day: 'numeric' });
            document.getElementById('maturityAmount').textContent = formatter.format(maturityAmount);
            document.getElementById('maturityPrincipal').textContent = formatter.format(principalMaturity);
            document.getElementById('maturityInterest').textContent = formatter.format(maturityInterest);
            document.getElementById('preMaturityAmount').textContent = formatter.format(preMaturityAmount);
            document.getElementById('preMaturityPrincipal').textContent = formatter.format(principalPreMaturity);
            document.getElementById('preMaturityInterest').textContent = formatter.format(preMaturityInterest);
            document.getElementById('avgInterestMonth').textContent = formatter.format(avgInterestMonth);
            document.getElementById('avgInterestYear').textContent = formatter.format(avgInterestYear);
        }
    </script>
</body>
</html>
